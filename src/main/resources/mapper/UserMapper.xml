<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="ReleaseBack.Back.mapper.UserMapper">

    <resultMap id="ProfileMap" type="ReleaseBack.Back.entity.Profile">
        <id property="id" column="user_id"/>
        <result property="bio" column="bio"/>
        <result property="avatarUrl" column="avatar_url"/>
        <result property="birthday" column="birthday"/>
        <result property="gender" column="gender"/>
    </resultMap>

    <select id="findByUsername" resultType="ReleaseBack.Back.entity.User">
        SELECT id, username, password, email
        FROM user
        WHERE username = #{username}
    </select>

    <select id="findByEmail" resultType="ReleaseBack.Back.entity.User">
        SELECT id, username, password, email
        FROM user
        WHERE email = #{email}
    </select>

    <insert id="saveUser" 
        parameterType="ReleaseBack.Back.entity.User"
        useGeneratedKeys="true" 
        keyProperty="id"
        >
        INSERT INTO user (username, password, email)
        VALUES (#{username}, #{password}, #{email})
    </insert>

    <insert id="createProfile" parameterType="ReleaseBack.Back.entity.Profile">
        INSERT INTO profiles (
            user_id,
            bio,
            avatar_url,
            birthday,
            gender
        )
        VALUES (
            #{id},
            #{bio},
            #{avatarUrl},
            #{birthday},
            #{gender}
        )
    </insert>

    <!-- findProfileById --> 

    <select id="findProfileById" 
        resultMap="ProfileMap"
        parameterType="int">
        SELECT user_id, bio, avatar_url, birthday, gender
        FROM profiles
        WHERE user_id = #{userid}
    </select>

    <!-- updateProfileBio --> 

    <update id="updateProfileBio">
        UPDATE profiles
        SET bio = #{bio}
        WHERE user_id = #{userid}
    </update>
</mapper>



